[build]
# 使用 Nixpacks 构建 (默认)
# 专门为分离式 client/server 结构设计
# 
# 方式一：使用分离式构建脚本（推荐）
buildCommand = "./nixpacks-build-separated.sh"
#
# 方式二：使用内联命令（备选方案）
# buildCommand = "cd client && npm ci --legacy-peer-deps && npm run build && cd ../server && npm ci --only=production --legacy-peer-deps"
#
watchPatterns = ["**"]

[deploy]
# 从 server 目录启动应用
startCommand = "cd server && npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[environments.production]
variables = { NODE_ENV = "production", PORT = "5001" } 